/**
 * @update 2013/8/29
 * */

// -------------------------------------------------------------
// ORIGINAL LICENSE
// -------------------------------------------------------------
/**
 * FlashSprite.js
 * --------------
 * Load and play sprite animations made by Flash CS6+
 *
 * @version 0.9.3 (2014/12/18)
 * @author mach3 <http://github.com/mach3>
 * @url http://github.com/mach3/flashspritejs
 * @require jquery.js
 */

(function(c){c.extend(c,{FlashSprite:function(d){var b=this;this.EVENT_READY="flashSpriteReady";this.EVENT_END="flashSpriteEnd";this.EVENT_ENTER_FRAME="flashSpriteEnterFrame";this.options={dataHeader:"application/json; charset=utf-16",src:null,fps:30,autoPlay:!0,repeat:!0};this.vars={frames:null,meta:null,image:null,width:null,height:null,length:null,interval:null};this.node=d;this.index=0;this.timer=null;this.init=function(a){a&&this.config(a);a.obj?this.setObj(a.obj):this._load()};this.config=function(a){c.extend(this.options,
a);this.vars.interval=Math.floor(1E3/this.options.fps)};this._call=function(a,b){c.isFunction(this[a])&&this[a].apply(this,b)};this._load=function(){var a=this.options;c.ajax({url:a.src,beforeSend:function(b){a.dataHeader&&b.overrideMimeType(a.dataHeader)}}).done(function(a){var e=new Image;c.extend(b.vars,{meta:a.meta,image:b.options.src.replace(/((\?|#).+|[^\/]+)?$/,"")+a.meta.image,frames:a.frames,length:a.frames.length,width:a.frames[0].sourceSize.w,height:a.frames[0].sourceSize.h});e.onload=
c.proxy(b._initNode,b);e.src=b.vars.image})};this.setObj=function(a){var d=new Image,e=b.options.src,e=null!=e?e.replace(/((\?|#).+|[^\/]+)?$/,""):"";c.extend(b.vars,{meta:a.meta,image:e+a.meta.image,frames:a.frames,length:a.frames.length,width:a.frames[0].sourceSize.w,height:a.frames[0].sourceSize.h});d.onload=c.proxy(b._initNode,b);d.src=b.vars.image};this._initNode=function(){this.node.width(this.vars.width).height(this.vars.height).css({"background-repeat":"no-repeat","background-image":"url("+
this.vars.image+")"});this.options.autoPlay&&this.play();this.node.trigger(this.EVENT_READY)};this.play=function(){this.stop();this._forward()};this.next=function(){var a=(this.index+1)%this.vars.length;(this.options.repeat||a)&&this._goto(a)};this._forward=function(){var a=b.index;b.next();a!==b.index?b.timer=setTimeout(b._forward,b.vars.interval):b.node.trigger(b.EVENT_END)};this.reverse=function(){this.stop();this._backward()};this.prev=function(){var a=this.index-1;if(0>a){if(!this.options.repeat)return;
a=this.vars.length-1}this._goto(a)};this._backward=function(){var a=b.index;b.prev();a!==b.index?b.timer=setTimeout(b._backward,b.vars.interval):b.node.trigger(b.EVENT_END)};this._goto=function(a){0>a||a>=this.vars.length||(this.index=a,this.node.css("background-position","-"+this.vars.frames[this.index].frame.x+"px -"+this.vars.frames[this.index].frame.y+"px").trigger(this.EVENT_ENTER_FRAME))};this.stop=function(){clearTimeout(b.timer);b.timer=null};this.gotoAndStop=function(a){this.stop();this._goto(a)};
this.gotoAndPlay=function(a){this._goto(a);this.play()};this.rewind=function(){this._goto(0)}}});c.fn.extend({flashSprite:function(){var d,b;d=Array.prototype.slice.call(arguments);b="string"===typeof d[0]?d.shift():"init";this.each(function(){var a=c(this);a.data("flashSprite")||a.data("flashSprite",new c.FlashSprite(a));a.data("flashSprite")._call(b,d)});return this}})})(jQuery);